<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>DoseSpot Demo</title>

    <style>
      body {
        font-family:
          system-ui,
          -apple-system,
          BlinkMacSystemFont,
          "Segoe UI",
          sans-serif;
        background: #f4f6f8;
        margin: 0;
      }

      input {
        padding: 10px 12px;
        margin-bottom: 18px;
        border-radius: 6px;
        border: 1px solid #ccc;
        font-size: 14px;
      }

      input:focus {
        outline: none;
        border-color: #2563eb;
      }

      .header {
        background: #fff;
        padding: 16px 24px;
        border-bottom: 1px solid #e5e7eb;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .header h1 {
        font-size: 18px;
        margin: 0;
      }

      .header button {
        margin-left: 16px;
        padding: 10px 16px;
        border: none;
        border-radius: 6px;
        background: #2563eb;
        color: #fff;
        font-weight: 600;
        cursor: pointer;
      }

      .header button:hover {
        background: #1e4fd8;
      }

      .header button:disabled {
        background: #e5e7eb;
        color: #a0aec0;
        cursor: not-allowed;
      }

      .iframe-wrapper {
        position: relative;
        padding: 24px;
      }

      iframe {
        width: 100%;
        height: 85vh;
        border: none;
        border-radius: 10px;
        background: #fff;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
      }

      .spinner {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 32px;
        height: 32px;
        border: 4px solid rgba(0, 0, 0, 0.15);
        border-top-color: #2563eb;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
    </style>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const clinicianIdInput = document.getElementById("clinician-id-input");

        const clinicianId = new URLSearchParams(window.location.search).get(
          "clinicianId",
        );

        if (clinicianId) {
          clinicianIdInput.value = clinicianId;
        }
      });

      async function getSSOLogin(id) {
        const response = await fetch(`/dosespot/login`, {
          method: "POST",
          body: JSON.stringify({ clinicianId: id }),
          headers: { "Content-Type": "application/json" },
        });
        const data = await response.json();
        return data.data;
      }

      async function launchDoseSpot() {
        const clinicianIdInput = document.getElementById("clinician-id-input");

        if (!clinicianIdInput.value) {
          return window.alert("Clinician ID is required to launch DoseSpot UI");
        }

        const wrapper = document.getElementById("iframe-wrapper");
        const btn = document.getElementById("launch-btn");

        btn.disabled = true;

        const spinner = document.createElement("div");
        spinner.classList.add("spinner");

        const iframe = document.createElement("iframe");
        iframe.src = await getSSOLogin(clinicianIdInput.value);

        iframe.onload = function () {
          wrapper.removeChild(spinner);
        };

        wrapper.append(spinner, iframe);
      }
    </script>
  </head>

  <body>
    <div class="header">
      <h1>DoseSpot ePrescribing</h1>
      <div>
        <label for="clinician-id-input"><strong>Clinican ID</strong></label>
        <input id="clinician-id-input" />
        <button id="launch-btn" onclick="launchDoseSpot()">
          Launch DoseSpot UI
        </button>
      </div>
    </div>

    <div id="iframe-wrapper" class="iframe-wrapper"></div>
  </body>
</html>
